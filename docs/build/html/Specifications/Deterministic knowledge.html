<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deterministic knowledge &mdash; pygformula 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Output" href="Output.html" />
    <link rel="prev" title="Visit process" href="Visit%20process.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pygformula
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Get%20Started.html">Get Started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Specifications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Input%20data.html">Input data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Interventions.html">Interventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Covariate%20models.html">Covariate models</a></li>
<li class="toctree-l2"><a class="reference internal" href="Outcome%20model.html">Outcome model</a></li>
<li class="toctree-l2"><a class="reference internal" href="Censoring%20event.html">Censoring event</a></li>
<li class="toctree-l2"><a class="reference internal" href="Competing%20event.html">Competing event</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hazard%20ratio.html">Hazard ratio</a></li>
<li class="toctree-l2"><a class="reference internal" href="Visit%20process.html">Visit process</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Deterministic knowledge</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#restrictions-on-covariates">Restrictions on covariates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restrictions-on-outcome">Restrictions on outcome</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restrictions-on-competing-event">Restrictions on competing event</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Output.html">Output</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Datasets.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contact.html">Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pygformula</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Specifications</a></li>
      <li class="breadcrumb-item active">Deterministic knowledge</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Specifications/Deterministic knowledge.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="deterministic-knowledge">
<span id="id1"></span><h1>Deterministic knowledge<a class="headerlink" href="#deterministic-knowledge" title="Permalink to this headline"></a></h1>
<p>When there are known deterministic knowledge, they can be incorporated into the g-formula algorithm to avoid unnecessary
extrapolation. The package allows users to apply restrictions of the deterministic knowledge on the covariates,
outcome or competing event.</p>
<section id="restrictions-on-covariates">
<h2>Restrictions on covariates<a class="headerlink" href="#restrictions-on-covariates" title="Permalink to this headline"></a></h2>
<p>When incorporating the deterministic knowledge of one time-varying covariate Z, the estimation is changed as follows:</p>
<p>1. In step 1 of the algorithm, restrict the chosen method of estimating the mean of Z given
“history” to only records where deterministic knowledge is absent.</p>
<p>2. In step 2 of the algorithm, set Z deterministically to its known value for histories under which this
value is known. Otherwise, draw Z according to the model-based estimate conditional distribution of Z.</p>
<p>For example, when there are two time-varying covariates, one indicator of whether an individual has started menopause
by a given interval k (menopause), and another indicator of whether she is pregnant in interval k (pregnancy).
The deterministic knowledge is that given menopause == 1, the probability that pregnancy == 0 is 1. In the first
estimation step, only records with menopause == 0 are used for model estimation of pregnancy. Then in the second
simulation step, if the value of menopause in step 1 at time k is 1 then pregnancy is set to 0. Otherwise, the value
of pregnancy at time k is drawn from the estimated distribution in step 1.</p>
<p>The package allows deterministic knowledge incorporation for covariates by the argument ‘‘restrictions’’:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Arguments</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>restrictions</p></td>
<td><p>(Optional) List of lists. Each inner list contains its first entry the covariate name of that its deterministic knowledge
is known; its second entry is a dictionary whose key is the conditions which should be True when the covariate
is modeled, the third entry is the value that is set to the covariate during simulation when the conditions
in the second entry are not True.</p></td>
</tr>
</tbody>
</table>
<p>Note that for each restricted covariate and its conditional covariates, they need to follow the same order in ‘‘covnames’’, i.e.,
the restricted covariate should be after its conditional covariates.</p>
<p>An example of the restrictions that encodes the relationship between menopause and pregnancy above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">restrictions</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;pregnancy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;menopause&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">restrictions</span> <span class="o">=</span> <span class="n">restrictions</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Sample syntax</strong>:</p>
<p>An example with one deterministic knowledge conditions for one covariate ‘L2’: if L1 equals 0, L2 is estimated
by its parametric model, otherwise, it is set to a known value 0.5.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">restrictions</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mf">0.5</span><span class="p">]]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">restrictions</span> <span class="o">=</span> <span class="n">restrictions</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>An example with multiple deterministic knowledge conditions for one covariate ‘A’: if L1 equals 0 and L2 is greater than 0.5, A is estimated
by its parametric model, otherwise, it is set to a known value 1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">restrictions</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">},</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">restrictions</span> <span class="o">=</span> <span class="n">restrictions</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>An example with multiple restrictions, one for covariate L2 and one for covariate A:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">restrictions</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">},</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">restrictions</span> <span class="o">=</span> <span class="n">restrictions</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>If the assigned value of the covariate is not a static value, but determined by a user-specified function,
the ‘‘restrictions’’ allows an input as a function type. In this case, the third entry for a restriction is a function
instead of a value.</p>
<p>For each custom restriction function, the input should be the parameters (not necessary to use all):</p>
<ul class="simple">
<li><p>new_df: A DataFrame that contains the observed or simulated data at time t.</p></li>
<li><p>pool: A DataFrame that contains the observed or simulated data up to time t.</p></li>
<li><p>time_name: A string specifying the name of the time variable in pool.</p></li>
<li><p>t: An integer specifying the current time index.</p></li>
</ul>
<p>The function output should be a list of values that users wish to assign for the restricted covariate at time t.
The package will automatically assign these values for records that are not restricted by the conditions.</p>
<p>An example with one deterministic knowledge condition for covariate L2: if L1 equals 0, L2 is estimated
by its parametric model, otherwise, its previous value is carried forward.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">carry_forward</span><span class="p">(</span><span class="n">new_df</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">time_name</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">assigned_values</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pool</span><span class="p">[</span><span class="n">time_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">assigned_values</span>

<span class="n">restrictions</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="n">carry_forward</span><span class="p">]]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">restrictions</span> <span class="o">=</span> <span class="n">restrictions</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Running example</strong> <a class="reference external" href="https://github.com/CausalInference/pygformula/blob/main/running_examples/test_restrictions.py">[code]</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pygformula</span>
<span class="kn">from</span> <span class="nn">pygformula.parametric_gformula.interventions</span> <span class="kn">import</span> <span class="n">static</span>
<span class="kn">from</span> <span class="nn">pygformula</span> <span class="kn">import</span> <span class="n">ParametricGformula</span>
<span class="kn">from</span> <span class="nn">pygformula.data</span> <span class="kn">import</span> <span class="n">load_basicdata_nocomp</span>

<span class="n">obs_data</span> <span class="o">=</span> <span class="n">load_basicdata_nocomp</span><span class="p">()</span>

<span class="n">time_name</span> <span class="o">=</span> <span class="s1">&#39;t0&#39;</span>
<span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>

<span class="n">covnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="n">covtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">]</span>
<span class="n">covmodels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L1 ~ lag1_L1 + lag1_A&#39;</span><span class="p">,</span>
             <span class="s1">&#39;L2 ~ L1 + lag1_L2&#39;</span><span class="p">,</span>
              <span class="s1">&#39;A ~ L1 + L2&#39;</span><span class="p">]</span>

<span class="n">basecovs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L3&#39;</span><span class="p">]</span>
<span class="n">outcome_name</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
<span class="n">ymodel</span> <span class="o">=</span> <span class="s1">&#39;Y ~ L1 + L2 + A&#39;</span>

<span class="c1"># define interventions</span>
<span class="n">time_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">obs_data</span><span class="p">[</span><span class="n">time_name</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">int_descript</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Never treat&#39;</span><span class="p">,</span> <span class="s1">&#39;Always treat&#39;</span><span class="p">]</span>

<span class="n">restrictions</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">},</span> <span class="mi">1</span><span class="p">]]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="n">obs_data</span> <span class="o">=</span> <span class="n">obs_data</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="n">time_name</span><span class="p">,</span>
    <span class="n">time_points</span> <span class="o">=</span> <span class="n">time_points</span><span class="p">,</span>
    <span class="n">int_descript</span> <span class="o">=</span> <span class="n">int_descript</span><span class="p">,</span>
    <span class="n">Intervention1_A</span> <span class="o">=</span> <span class="p">[</span><span class="n">static</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">time_points</span><span class="p">)],</span>
    <span class="n">Intervention2_A</span> <span class="o">=</span> <span class="p">[</span><span class="n">static</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">time_points</span><span class="p">)],</span>
    <span class="n">covnames</span><span class="o">=</span><span class="n">covnames</span><span class="p">,</span> <span class="n">covtypes</span><span class="o">=</span><span class="n">covtypes</span><span class="p">,</span>
    <span class="n">covmodels</span><span class="o">=</span><span class="n">covmodels</span><span class="p">,</span> <span class="n">basecovs</span><span class="o">=</span><span class="n">basecovs</span><span class="p">,</span>
    <span class="n">restrictions</span><span class="o">=</span><span class="n">restrictions</span><span class="p">,</span> <span class="n">outcome_name</span><span class="o">=</span><span class="n">outcome_name</span><span class="p">,</span>
    <span class="n">ymodel</span><span class="o">=</span><span class="n">ymodel</span><span class="p">,</span> <span class="n">outcome_type</span><span class="o">=</span><span class="s1">&#39;survival&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Output</strong>:</p>
<blockquote>
<div><img alt="../_images/restriction_example_output.png" class="align-center" src="../_images/restriction_example_output.png" />
</div></blockquote>
</section>
<section id="restrictions-on-outcome">
<h2>Restrictions on outcome<a class="headerlink" href="#restrictions-on-outcome" title="Permalink to this headline"></a></h2>
<p>When there is deterministic knowledge of the outcome variable Y, the package offers the argument
‘‘restrictions’’ to incorporate the knowledge:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Arguments</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>yrestrictions</p></td>
<td><p>(Optional) List of lists. For each inner list, its first entry is a dictionary whose key is the conditions which
should be True when the outcome is modeled, the second entry is the value that is set to the outcome during
simulation when the conditions in the first entry are not True.</p></td>
</tr>
</tbody>
</table>
<p><strong>Sample syntax</strong>:</p>
<p>An example with one deterministic knowledge conditions for outcome Y: if L1 equals 0, the probability of outcome Y is estimated
by its parametric model, otherwise, it is set to value 1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yrestrictions</span> <span class="o">=</span> <span class="p">[[{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">yrestrictions</span> <span class="o">=</span> <span class="n">yrestrictions</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>An example with multiple restrcitions for outcome Y: if L1 equals 0,
the probability of outcome Y is estimated by its parametric model, otherwise, it is set to a value 0; if L2 is greater than 0.5,
the probability of outcome Y is estimated by its parametric model, otherwise, it is set to a value 0.1;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yrestrictions</span> <span class="o">=</span> <span class="p">[[{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[{</span><span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">},</span> <span class="mf">0.1</span><span class="p">]]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">yrestrictions</span> <span class="o">=</span> <span class="n">yrestrictions</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Running example</strong> <a class="reference external" href="https://github.com/CausalInference/pygformula/blob/main/running_examples/test_yrestrictions.py">[code]</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pygformula</span>
<span class="kn">from</span> <span class="nn">pygformula</span> <span class="kn">import</span> <span class="n">ParametricGformula</span>
<span class="kn">from</span> <span class="nn">pygformula.parametric_gformula.interventions</span> <span class="kn">import</span> <span class="n">static</span>
<span class="kn">from</span> <span class="nn">pygformula.data</span> <span class="kn">import</span> <span class="n">load_basicdata_nocomp</span>

<span class="n">obs_data</span> <span class="o">=</span> <span class="n">load_basicdata_nocomp</span><span class="p">()</span>

<span class="n">time_name</span> <span class="o">=</span> <span class="s1">&#39;t0&#39;</span>
<span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>

<span class="n">covnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="n">covtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">]</span>
<span class="n">covmodels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L1 ~ lag1_L1 + lag1_A&#39;</span><span class="p">,</span>
             <span class="s1">&#39;L2 ~ L1 + lag1_L2&#39;</span><span class="p">,</span>
              <span class="s1">&#39;A ~ L1 + L2&#39;</span><span class="p">]</span>

<span class="n">basecovs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L3&#39;</span><span class="p">]</span>
<span class="n">outcome_name</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
<span class="n">ymodel</span> <span class="o">=</span> <span class="s1">&#39;Y ~ L1 + L2 + A&#39;</span>

<span class="c1"># define interventions</span>
<span class="n">time_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">obs_data</span><span class="p">[</span><span class="n">time_name</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">int_descript</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Never treat&#39;</span><span class="p">,</span> <span class="s1">&#39;Always treat&#39;</span><span class="p">]</span>

<span class="n">yrestrictions</span> <span class="o">=</span> <span class="p">[[{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[{</span><span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">},</span> <span class="mf">0.1</span><span class="p">]]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="n">obs_data</span> <span class="o">=</span> <span class="n">obs_data</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="n">time_name</span><span class="p">,</span>
    <span class="n">time_points</span> <span class="o">=</span> <span class="n">time_points</span><span class="p">,</span>
    <span class="n">int_descript</span> <span class="o">=</span> <span class="n">int_descript</span><span class="p">,</span>
    <span class="n">Intervention1_A</span> <span class="o">=</span> <span class="p">[</span><span class="n">static</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">time_points</span><span class="p">)],</span>
    <span class="n">Intervention2_A</span> <span class="o">=</span> <span class="p">[</span><span class="n">static</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">time_points</span><span class="p">)],</span>
    <span class="n">covnames</span><span class="o">=</span><span class="n">covnames</span><span class="p">,</span>  <span class="n">covtypes</span><span class="o">=</span><span class="n">covtypes</span><span class="p">,</span> <span class="n">covmodels</span><span class="o">=</span><span class="n">covmodels</span><span class="p">,</span> <span class="n">basecovs</span><span class="o">=</span><span class="n">basecovs</span><span class="p">,</span>
    <span class="n">yrestrictions</span><span class="o">=</span><span class="n">yrestrictions</span><span class="p">,</span> <span class="n">outcome_name</span><span class="o">=</span><span class="n">outcome_name</span><span class="p">,</span>
    <span class="n">ymodel</span><span class="o">=</span><span class="n">ymodel</span><span class="p">,</span> <span class="n">outcome_type</span><span class="o">=</span><span class="s1">&#39;survival&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Output</strong>:</p>
<blockquote>
<div><img alt="../_images/yrestriction_example_output.png" class="align-center" src="../_images/yrestriction_example_output.png" />
</div></blockquote>
</section>
<section id="restrictions-on-competing-event">
<h2>Restrictions on competing event<a class="headerlink" href="#restrictions-on-competing-event" title="Permalink to this headline"></a></h2>
<p>When there is a competing event D and there is known deterministic knowledge of the competing event,
the package offers the argument ‘‘compevent_restrictions’’ for incorporation:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Arguments</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>compevent_restrictions</p></td>
<td><p>(Optional) List of lists. For each inner list, its first entry is a dictionary whose key is the conditions which
should be True when the competing event is modeled, the second entry is the value that is set to the competing
event during simulation when the conditions in the first entry are not True. Only applicable for survival outcomes.</p></td>
</tr>
</tbody>
</table>
<p><strong>Sample syntax</strong>:</p>
<p>An example with one deterministic knowledge conditions for competing event D: if L1 equals 0, the probability of competing
event is estimated by its parametric model, otherwise, it is set to a value 1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compevent_restrictions</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">compevent_restrictions</span> <span class="o">=</span> <span class="n">compevent_restrictions</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>An example with multiple restrictions for competing event D: if L1 equals 0, the probability of competing
event is estimated by its parametric model, otherwise, it is set to a value 1; if L2 is greater than 0.5,
the probability of competing event is estimated by its parametric model, otherwise,
it is set to a value 0.1;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compevent_restrictions</span> <span class="o">=</span> <span class="p">[[{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[{</span><span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">},</span> <span class="mf">0.1</span><span class="p">]]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">compevent_restrictions</span> <span class="o">=</span> <span class="n">compevent_restrictions</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Running example</strong> <a class="reference external" href="https://github.com/CausalInference/pygformula/blob/main/running_examples/test_comp_restrictions.py">[code]</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pygformula</span>
<span class="kn">from</span> <span class="nn">pygformula</span> <span class="kn">import</span> <span class="n">ParametricGformula</span>
<span class="kn">from</span> <span class="nn">pygformula.parametric_gformula.interventions</span> <span class="kn">import</span> <span class="n">static</span>
<span class="kn">from</span> <span class="nn">pygformula.data</span> <span class="kn">import</span> <span class="n">load_basicdata</span>

<span class="n">obs_data</span> <span class="o">=</span> <span class="n">load_basicdata</span><span class="p">()</span>

<span class="n">covnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">]</span>
<span class="n">covtypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;bounded normal&#39;</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">]</span>
<span class="n">covmodels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L1 ~ lag1_A + lag2_A + lag_cumavg1_L1 + lag_cumavg1_L2 + L3 + t0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;L2 ~ lag1_A + L1 + lag_cumavg1_L1 + lag_cumavg1_L2  + L3 + t0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;A ~ lag1_A + L1 + L2 +lag_cumavg1_L1 + lag_cumavg1_L2 + L3 + t0&#39;</span><span class="p">]</span>

<span class="n">outcome_model</span> <span class="o">=</span> <span class="s1">&#39;Y ~ A + L1 + L2 + L3 + lag1_A + lag1_L1 + lag1_L2&#39;</span>

<span class="n">time_name</span> <span class="o">=</span> <span class="s1">&#39;t0&#39;</span>
<span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>
<span class="n">outcome_name</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
<span class="n">basecovs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L3&#39;</span><span class="p">]</span>

<span class="n">compevent_name</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>
<span class="n">compevent_model</span> <span class="o">=</span> <span class="s1">&#39;D ~ A + L1 + L2 + L3 + t0&#39;</span>
<span class="n">compevent_cens</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">time_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">obs_data</span><span class="p">[</span><span class="n">time_name</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">int_descript</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Never treat&#39;</span><span class="p">,</span> <span class="s1">&#39;Always treat&#39;</span><span class="p">]</span>

<span class="n">compevent_restrictions</span> <span class="o">=</span> <span class="p">[[{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">},</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[{</span><span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">},</span> <span class="mf">0.1</span><span class="p">]]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">ParametricGformula</span><span class="p">(</span><span class="n">obs_data</span> <span class="o">=</span> <span class="n">obs_data</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">,</span> <span class="n">time_points</span> <span class="o">=</span> <span class="n">time_points</span><span class="p">,</span>
    <span class="n">time_name</span><span class="o">=</span><span class="n">time_name</span><span class="p">,</span> <span class="n">int_descript</span> <span class="o">=</span> <span class="n">int_descript</span><span class="p">,</span>
    <span class="n">Intervention1_A</span> <span class="o">=</span> <span class="p">[</span><span class="n">static</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">time_points</span><span class="p">)],</span>
    <span class="n">Intervention2_A</span> <span class="o">=</span> <span class="p">[</span><span class="n">static</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">time_points</span><span class="p">)],</span>
    <span class="n">basecovs</span> <span class="o">=</span><span class="n">basecovs</span><span class="p">,</span> <span class="n">covnames</span><span class="o">=</span><span class="n">covnames</span><span class="p">,</span>
    <span class="n">covtypes</span><span class="o">=</span><span class="n">covtypes</span><span class="p">,</span> <span class="n">covmodels</span><span class="o">=</span><span class="n">covmodels</span><span class="p">,</span>
    <span class="n">compevent_restrictions</span> <span class="o">=</span> <span class="n">compevent_restrictions</span><span class="p">,</span>
    <span class="n">compevent_cens</span><span class="o">=</span> <span class="n">compevent_cens</span><span class="p">,</span> <span class="n">compevent_name</span> <span class="o">=</span> <span class="n">compevent_name</span><span class="p">,</span>
    <span class="n">compevent_model</span><span class="o">=</span><span class="n">compevent_model</span><span class="p">,</span> <span class="n">outcome_name</span><span class="o">=</span><span class="n">outcome_name</span><span class="p">,</span>
    <span class="n">outcome_type</span><span class="o">=</span><span class="s1">&#39;survival&#39;</span><span class="p">,</span> <span class="n">ymodel</span><span class="o">=</span><span class="n">ymodel</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Output</strong>:</p>
<blockquote>
<div><img alt="../_images/comp_restriction_example_output.png" class="align-center" src="../_images/comp_restriction_example_output.png" />
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Visit%20process.html" class="btn btn-neutral float-left" title="Visit process" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Output.html" class="btn btn-neutral float-right" title="Output" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, CAUSALab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>